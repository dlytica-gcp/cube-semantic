import{B as I,T as B,R as U,C as z}from"./index-2a334e56.js";import{D as q}from"./index-17f232aa.js";import{u as G,F as H,I as O,S as D}from"./index-f28b3217.js";import{j as e,S as W}from"./index-31f541c4.js";import{T as J,a as K,A as Q}from"./index-74275833.js";import{m as v}from"./index-4e5c896b.js";import{r as N,u as X}from"./react-venders-3a9fd7ec.js";import{M as Y,a as Z}from"./index-166ce56c.js";import{u as w}from"./useTranslation-f1e31b7f.js";import{P as V}from"./index-0f090c4c.js";import{C as ee,u as se,x as te,y as oe}from"./CurrentUserStore-886fe293.js";import{u as S}from"./useCheckResponse-471c00b7.js";import{C as re}from"./index-81782579.js";import{f as _}from"./formatTime-900939d2.js";import{R as $}from"./team-a9599a92.js";import{u as ne}from"./useLocation-795e9ebc.js";import{T as A}from"./paths-1d44e380.js";import{S as ie}from"./SettingOutlined-58db4ea1.js";import"./button-255d95e9.js";import"./Sider-2eea88ce.js";import"./dayjs.min-e1e47a26.js";import"./index-d72c3122.js";import"./tslib.es6-5f87f175.js";import"./urql.es-e4ed66a8.js";import"./index-801816c4.js";const ae="_submit_t4e6n_1",ce={submit:ae},{Title:de}=B,le=({initialValue:o,onSubmit:n})=>{const{t:i}=w(["settings","common"]),{control:p,handleSubmit:a}=G({values:o});return e.jsxs(H,{layout:"vertical",children:[e.jsx(de,{level:4,children:i("members.team_settings.title")}),e.jsx(O,{label:i("members.team_settings.team_name"),name:"name",control:p,rules:{required:!0},defaultValue:o==null?void 0:o.name}),e.jsx(I,{className:ce.submit,size:"large",type:"primary",onClick:a(n),children:i("members.team_settings.save")})]})},me="/assets/no-roles-474b06f4.png",pe="_wrapper_1f9ck_1",ue="_img_1f9ck_11",xe="_text_1f9ck_14",fe="_btn_1f9ck_17",E={wrapper:pe,img:ue,text:xe,btn:fe},{Title:ge,Text:he}=B,_e=()=>{const{t:o}=w(["teams","common"]);return e.jsxs("div",{className:E.wrapper,"data-testid":"no-teams",children:[e.jsx("img",{className:E.img,src:me,alt:""}),e.jsx(ge,{level:4,children:o("not_found.title")}),e.jsx(he,{className:E.text,children:o("not_found.text")})]})},je="_wrapper_5pvfx_1",we="_tag_5pvfx_4",Te="_body_5pvfx_11",j={wrapper:je,tag:we,body:Te},Ce=["#000000","#470D69","#A31BCB"],be=({userId:o,teams:n,currentTeam:i,onCreateOrEditTeam:p=()=>{},onRemoveTeam:a=()=>{},onSelect:T=()=>{},loading:f=!1,isOpen:C=!1,onClose:d=()=>{},onOpen:u=()=>{},editId:m})=>{const{t:r}=w(["teams","pages"]),[g,h]=N.useState(),x=s=>{u(s.id)},b=()=>{h({name:""}),d()},y=s=>{p(s),d==null||d()},M=()=>{u==null||u()},k=s=>{var R,F;const t=(F=(R=((s==null?void 0:s.members)||[]).find(c=>c.user_id===o))==null?void 0:R.role)==null?void 0:F.name,l=t!==$.member,L=t===$.owner;return e.jsx(re,{title:e.jsxs(e.Fragment,{children:[s.name,s.id===(i==null?void 0:i.id)&&e.jsx(J,{className:j.tag,color:"#EDE7F0",children:r("common:words.current")})]}),titleTooltip:s.name,onTitleClick:()=>l&&x(s),extra:e.jsx(q,{className:j.btn,trigger:["click"],menu:{items:[l&&{key:"edit",label:r("common:words.edit"),onClick:()=>x(s)},{key:"select",label:r("common:words.set_current"),onClick:()=>T(s.id)},L&&{key:"delete",label:e.jsx(Z,{title:r("common:words.delete_alert"),onConfirm:()=>a(s.id),children:r("common:words.delete")})}].filter(Boolean)},children:e.jsx(ie,{},"setting")}),children:e.jsxs("dl",{children:[s.members&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:e.jsxs("span",{children:[s.members.length," ",r("common:words.members")]})}),e.jsx("dd",{children:e.jsx(D,{size:10,align:"center",children:e.jsx(K,{children:s.members.slice(0,3).map((c,P)=>e.jsx(Q,{color:Ce[P],img:c==null?void 0:c.avatarUrl,username:c==null?void 0:c.displayName,width:32,height:32},c.id))})})})]}),(s==null?void 0:s.creatorEmail)&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:r("common:words.creator")}),e.jsx("dd",{title:s==null?void 0:s.creatorEmail,children:s==null?void 0:s.creatorEmail})]}),s.createdAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:r("common:words.created_at")}),e.jsx("dd",{title:_(s.createdAt),children:_(s.createdAt)})]}),s.updatedAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:r("common:words.updated_at")}),e.jsx("dd",{title:_(s.updatedAt),children:_(s.updatedAt)})]})]})},s.id)};return N.useEffect(()=>{m&&h(n.find(s=>s.id===m))},[m,n]),e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:j.wrapper,direction:"vertical",size:13,children:[e.jsx(V,{title:r("manage_teams"),action:r("create_team"),onClick:M}),e.jsx(W,{spinning:f,children:n.length?e.jsx("div",{className:j.body,children:e.jsx(U,{justify:"start",gutter:[32,32],children:n==null?void 0:n.map(s=>e.jsx(z,{xs:24,sm:12,xl:8,children:k(s)},s.id))})}):e.jsx(_e,{})})]}),e.jsx(Y,{open:C,closable:!0,onClose:b,children:e.jsx(le,{initialValue:g,onSubmit:y})})]})},Qe=()=>{const{t:o}=w(["teams","pages"]),{currentUser:n,currentTeam:i,loading:p,setLoading:a,setCurrentTeam:T}=ee(),[f,C]=se(),[d,u]=te(),[m,r]=oe(),{editId:g}=X(),h=g==="new",[,x]=ne();S(f,(t,l)=>{t&&v.success(o("team_created")),l!=null&&l.message&&(l.message.match("teams_user_id_name_key")?v.error(o("team_name_error")):v.error(l.message)),a(!1)},{showMessage:!1,showResponseMessage:!1}),S(d,()=>{a(!1)},{successMessage:o("team_updated")}),S(m,()=>{a(!1)},{successMessage:o("team_deleted")});const b=t=>{a(!0),t.id?u({pk_columns:{id:t.id},_set:{name:t.name}}):C({name:t.name})},y=t=>{a(!0),r({id:t})},M=t=>{T(t)},k=N.useMemo(()=>p||f.fetching||d.fetching||m.fetching,[p,f.fetching,m.fetching,d.fetching]),s=t=>{x(t?`${A}/${t}`:`${A}/new`)};return e.jsx(be,{userId:n.id,teams:n.teams,currentTeam:i,onCreateOrEditTeam:b,onRemoveTeam:y,onSelect:M,loading:k,isOpen:!!g,editId:h?void 0:g,onClose:()=>x(A),onOpen:s})};export{be as Teams,Qe as default};
