import{R as q,C as z,B as R,T as L}from"./index-2a334e56.js";import{u as H,F as Q,I as $,S as V,b as O}from"./index-f28b3217.js";import{j as e,S as W}from"./index-31f541c4.js";import{A as G,T as J}from"./index-74275833.js";import{m as C}from"./index-4e5c896b.js";import{r as N,u as K}from"./react-venders-3a9fd7ec.js";import{C as X}from"./index-81782579.js";import{M as Y,a as Z}from"./index-166ce56c.js";import{C as y,R as d}from"./team-a9599a92.js";import{v as ee}from"./validations-55614028.js";import{u as A}from"./useTranslation-f1e31b7f.js";import{P as se}from"./index-0f090c4c.js";import{C as te,z as oe,A as ae,B as re,D as ne}from"./CurrentUserStore-886fe293.js";import{u as E}from"./useCheckResponse-471c00b7.js";import{u as ie}from"./useLocation-795e9ebc.js";import{d as T}from"./paths-1d44e380.js";import{c as p}from"./capitalize-b2c18dd5.js";import{f as w}from"./formatTime-900939d2.js";import{C as le}from"./trash-colored-debd1411.js";import"./button-255d95e9.js";import"./dayjs.min-e1e47a26.js";import"./index-d72c3122.js";import"./tslib.es6-5f87f175.js";import"./urql.es-e4ed66a8.js";import"./index-801816c4.js";const me="_submit_t4e6n_1",ce={submit:me},{Title:de}=L,pe=({onSubmit:r,initialValue:o,inviteRoles:t})=>{const{t:a}=A(["settings","common"]),{control:_,handleSubmit:c}=H({values:o});return e.jsxs(Q,{layout:"vertical",children:[e.jsx(de,{level:4,style:{marginTop:0},children:a("members.members.title")}),e.jsxs(q,{gutter:[16,16],children:[e.jsx(z,{span:24,md:12,children:e.jsx($,{label:a("members.members.invite_team_member"),name:"email",control:_,rules:{required:!0,validate:f=>ee.email(f)||a("common:form.errors.email")}})}),e.jsx(z,{span:24,md:12,children:e.jsx($,{label:a("members.members.select_role"),name:"role",control:_,fieldType:"select",defaultValue:y.member,options:t})})]}),e.jsx(R,{className:ce.submit,size:"large",type:"primary",onClick:c(r),children:a("members.members.invite")})]})},_e="/assets/no-member-1e5d8553.png",ue="_wrapper_1f9ck_1",fe="_img_1f9ck_11",xe="_text_1f9ck_14",ge="_btn_1f9ck_17",P={wrapper:ue,img:fe,text:xe,btn:ge},{Title:je,Text:he}=L,be=({onInvite:r=()=>{}})=>{const{t:o}=A(["settings","common"]);return e.jsxs("div",{className:P.wrapper,children:[e.jsx("img",{className:P.img,src:_e,alt:""}),e.jsx(je,{level:4,children:o("members.not_found.title")}),e.jsx(he,{className:P.text,children:o("members.not_found.text")}),e.jsx(R,{size:"large",type:"primary",onClick:r,children:o("members.not_found.invite_btn")})]})},D=r=>Object.keys(r).filter(o=>isNaN(o)).map(o=>({value:o,label:p(o)})),ve="_wrapper_1jff8_1",Me="_body_1jff8_4",Ce="_removeBtn_1jff8_7",we="_roleName_1jff8_27",Ne="_title_1jff8_33",ye="_cardAvatar_1jff8_39",Ae="_paragraph_1jff8_42",ke="_tag_1jff8_49",Ie="_dl_1jff8_54",m={wrapper:ve,body:Me,removeBtn:Ce,roleName:we,title:Ne,cardAvatar:ye,paragraph:Ae,tag:ke,dl:Ie},{Paragraph:Fe}=L,Se=({userId:r,members:o,accessLists:t,currentRole:a,loading:_=!1,onDeleteMember:c=()=>{},onInviteMember:f=()=>{},onRoleChange:k=()=>{},onAccessListChange:I=()=>{},onClose:x=()=>{},onOpen:g=()=>{},isOpen:j=!1})=>{const{t:l}=A(["settings","pages"]),h=s=>{x(),f(s)},u=s=>c(s.id),b=s=>{var M,i;const v=a===d.owner&&s.role.name!==d.owner||a===d.admin&&s.role.name===d.member,B=s.role.name===d.member&&a!==d.member;return e.jsx(X,{title:e.jsxs("div",{className:m.title,children:[e.jsx(G,{username:s.displayName,img:s.avatarUrl,className:m.cardAvatar}),e.jsx(Fe,{ellipsis:!0,className:m.paragraph,children:s.displayName}),s.user_id===r&&e.jsx(J,{className:m.tag,color:"#EDE7F0",children:l("common:words.current")})]}),titleTooltip:s.displayName,extra:v&&e.jsx(Z,{title:l("common:words.delete_member"),onConfirm:()=>u(s),children:e.jsx(R,{size:"small",type:"text",className:m.removeBtn,children:e.jsx(le,{})})}),children:e.jsxs("dl",{className:m.dl,children:[s.email&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:l("common:words.email")}),e.jsx("dd",{title:s.email,children:s.email})]}),s.role&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:l("common:words.role")}),e.jsx("dd",{title:p(s.role.name),className:m.roleName,children:v?e.jsx(O,{onChange:n=>k(s.role.id,n),variant:"borderless",value:s.role.name,options:D(y)}):p(s.role.name)}),e.jsx("dt",{children:l("common:words.access_list")}),e.jsx("dd",{title:p(s.role.name),className:m.roleName,children:B?e.jsx(O,{onChange:n=>{I(s.role.id,n)},variant:"borderless",disabled:!(t!=null&&t.length),value:((M=s.accessList)==null?void 0:M.id)||p(l("common:words.full_access").toUpperCase()),options:[{label:p(l("common:words.full_access").toUpperCase()),value:null},...(t||[]).map(n=>({value:n.id,label:n.name}))]}):((i=s==null?void 0:s.accessList)==null?void 0:i.name)||p(s.role.name)})]}),s.updatedAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:l("common:words.updated_at")}),e.jsx("dd",{title:w(s.updatedAt),children:w(s.updatedAt)})]}),s.createdAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:l("common:words.created_at")}),e.jsx("dd",{title:w(s.createdAt),children:w(s.createdAt)})]})]})},s.id)},F=a!==d.member,S=N.useMemo(()=>{const s=y;return a===d.admin&&delete s.admin,D(s)},[a]);return e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:m.wrapper,direction:"vertical",size:13,children:[e.jsx(se,{title:l("settings:members.title"),action:F&&l("settings:members.action"),onClick:g}),e.jsx(W,{spinning:_,children:o.length?e.jsx("div",{className:m.body,children:e.jsx(q,{justify:"start",gutter:[32,32],children:o.map(s=>e.jsx(z,{xs:24,sm:12,xl:8,children:b(s)},s.id))})}):e.jsx(be,{onInvite:g})})]}),e.jsx(Y,{open:j,closable:!0,onClose:x,children:e.jsx(pe,{onSubmit:h,inviteRoles:S})})]})},Be=r=>{var o;return(o=r==null?void 0:r.access_lists)!=null&&o.length?(r.access_lists||[]).map(t=>({id:t.id,name:t.name,teamId:t.team_id,config:t.config,createdAt:t.created_at,updatedAt:t.updated_at})):[]},as=()=>{const{t:r}=A(["settings","pages"]),{currentUser:o,currentTeam:t,teamData:a,loading:_,setLoading:c}=te(),[f,k]=oe(),[I,x]=ae(),[g,j]=re(),{slug:l}=K(),[,h]=ie(),[u,b]=ne({variables:{where:{team_id:{_eq:t==null?void 0:t.id}}},pause:!0});E(f,i=>{var n;(n=i.delete_members_by_pk)!=null&&n.id?C.success(r("settings:members:member_deleted")):C.warning(r("settings:members:no_permissions"))},{successMessage:""}),E(I,()=>{},{successMessage:r("settings:members:member_invited")}),E(g,i=>{var n;(n=i.update_member_roles_by_pk)!=null&&n.id?C.success(r("settings:members:role_updated")):C.warning(r("settings:members:no_permissions"))},{successMessage:""});const F=i=>{c(!0),k({id:i})},S=(i,n)=>{c(!0);const U={team_role:n.toLowerCase()};n!==y.member&&(U.access_list_id=null),j({pk_columns:{id:i},_set:U})},s=(i,n)=>{c(!0),j({pk_columns:{id:i},_set:{access_list_id:n}})},v=i=>{c(!0),x({...i,role:i.role.toLowerCase(),teamId:t==null?void 0:t.id})};N.useEffect(()=>{t!=null&&t.id&&b()},[t==null?void 0:t.id,b]);const B=N.useMemo(()=>(a==null?void 0:a.members)||[],[a==null?void 0:a.members]),M=N.useMemo(()=>Be(u==null?void 0:u.data),[u]);return e.jsx(Se,{userId:o==null?void 0:o.id,members:B,loading:_,accessLists:M,currentRole:t==null?void 0:t.role,onDeleteMember:F,onInviteMember:v,onRoleChange:S,onAccessListChange:s,isOpen:l==="new",onClose:()=>h(T),onOpen:()=>h(`${T}/new`)})};export{Se as Members,as as default};
