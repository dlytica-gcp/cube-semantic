import{c as T}from"./index-801816c4.js";function U(l,o){let a;try{a=l()}catch{return}return{getItem:s=>{var e;const u=m=>m===null?null:JSON.parse(m,o==null?void 0:o.reviver),v=(e=a.getItem(s))!=null?e:null;return v instanceof Promise?v.then(u):u(v)},setItem:(s,e)=>a.setItem(s,JSON.stringify(e,o==null?void 0:o.replacer)),removeItem:s=>a.removeItem(s)}}const I=l=>o=>{try{const a=l(o);return a instanceof Promise?a:{then(r){return I(r)(a)},catch(r){return this}}}catch(a){return{then(r){return this},catch(r){return I(r)(a)}}}},b=(l,o)=>(a,r,s)=>{let e={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:n=>n,version:0,merge:(n,d)=>({...d,...n}),...o},u=!1;const v=new Set,m=new Set;let c;try{c=e.getStorage()}catch{}if(!c)return l((...n)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),a(...n)},r,s);const S=I(e.serialize),y=()=>{const n=e.partialize({...r()});let d;const t=S({state:n,version:e.version}).then(h=>c.setItem(e.name,h)).catch(h=>{d=h});if(d)throw d;return t},g=s.setState;s.setState=(n,d)=>{g(n,d),y()};const f=l((...n)=>{a(...n),y()},r,s);let p;const i=()=>{var n;if(!c)return;u=!1,v.forEach(t=>t(r()));const d=((n=e.onRehydrateStorage)==null?void 0:n.call(e,r()))||void 0;return I(c.getItem.bind(c))(e.name).then(t=>{if(t)return e.deserialize(t)}).then(t=>{if(t)if(typeof t.version=="number"&&t.version!==e.version){if(e.migrate)return e.migrate(t.state,t.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return t.state}).then(t=>{var h;return p=e.merge(t,(h=r())!=null?h:f),a(p,!0),y()}).then(()=>{d==null||d(p,void 0),u=!0,m.forEach(t=>t(p))}).catch(t=>{d==null||d(void 0,t)})};return s.persist={setOptions:n=>{e={...e,...n},n.getStorage&&(c=n.getStorage())},clearStorage:()=>{c==null||c.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>i(),hasHydrated:()=>u,onHydrate:n=>(v.add(n),()=>{v.delete(n)}),onFinishHydration:n=>(m.add(n),()=>{m.delete(n)})},i(),p||f},k=(l,o)=>(a,r,s)=>{let e={storage:U(()=>localStorage),partialize:i=>i,version:0,merge:(i,n)=>({...n,...i}),...o},u=!1;const v=new Set,m=new Set;let c=e.storage;if(!c)return l((...i)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),a(...i)},r,s);const S=()=>{const i=e.partialize({...r()});return c.setItem(e.name,{state:i,version:e.version})},y=s.setState;s.setState=(i,n)=>{y(i,n),S()};const g=l((...i)=>{a(...i),S()},r,s);let f;const p=()=>{var i,n;if(!c)return;u=!1,v.forEach(t=>{var h;return t((h=r())!=null?h:g)});const d=((n=e.onRehydrateStorage)==null?void 0:n.call(e,(i=r())!=null?i:g))||void 0;return I(c.getItem.bind(c))(e.name).then(t=>{if(t)if(typeof t.version=="number"&&t.version!==e.version){if(e.migrate)return e.migrate(t.state,t.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return t.state}).then(t=>{var h;return f=e.merge(t,(h=r())!=null?h:g),a(f,!0),S()}).then(()=>{d==null||d(f,void 0),f=r(),u=!0,m.forEach(t=>t(f))}).catch(t=>{d==null||d(void 0,t)})};return s.persist={setOptions:i=>{e={...e,...i},i.storage&&(c=i.storage)},clearStorage:()=>{c==null||c.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>p(),hasHydrated:()=>u,onHydrate:i=>(v.add(i),()=>{v.delete(i)}),onFinishHydration:i=>(m.add(i),()=>{m.delete(i)})},e.skipHydration||p(),f||g},A=(l,o)=>"getStorage"in o||"serialize"in o||"deserialize"in o?b(l,o):k(l,o),H=A;function w(l){this.message=l}w.prototype=new Error,w.prototype.name="InvalidCharacterError";var E=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(l){var o=String(l).replace(/=+$/,"");if(o.length%4==1)throw new w("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,r,s=0,e=0,u="";r=o.charAt(e++);~r&&(a=s%4?64*a+r:r,s++%4)?u+=String.fromCharCode(255&a>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return u};function C(l){var o=l.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(a){return decodeURIComponent(E(a).replace(/(.)/g,function(r,s){var e=s.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}(o)}catch{return E(o)}}function _(l){this.message=l}function L(l,o){if(typeof l!="string")throw new _("Invalid token specified");var a=(o=o||{}).header===!0?0:1;try{return JSON.parse(C(l.split(".")[a]))}catch(r){throw new _("Invalid token specified: "+r.message)}}_.prototype=new Error,_.prototype.name="InvalidTokenError";const R={refreshToken:null,accessToken:null,JWTpayload:null},J=T()(H(l=>({...R,setAuthData:o=>{const{accessToken:a,refreshToken:r}=o,s=L(a),e={...s,...s.hasura};delete e.hasura,l({refreshToken:r,accessToken:a,JWTpayload:e})},cleanTokens:()=>l({...R})}),{name:"tokens",getStorage:()=>localStorage}));export{J as A};
