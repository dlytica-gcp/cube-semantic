import{R as W,C as q}from"./index-2a334e56.js";import{D as B}from"./index-17f232aa.js";import{S as J}from"./index-f28b3217.js";import{j as e,S as K}from"./index-31f541c4.js";import{u as Q}from"./index-d72c3122.js";import{r as d,u as V}from"./react-venders-3a9fd7ec.js";import{d as I,D as X,u as Y}from"./useOnboarding-2998ad07.js";import{C as Z}from"./index-81782579.js";import{M as ee,a as te}from"./index-166ce56c.js";import{N as se}from"./index-e26e008e.js";import{P as oe}from"./index-0f090c4c.js";import{f as M}from"./formatTime-900939d2.js";import{D as ne}from"./index-d5b304fb.js";import{C as re,i as ie}from"./CurrentUserStore-886fe293.js";import{u as ae}from"./useCheckResponse-471c00b7.js";import{u as N}from"./useLocation-795e9ebc.js";import{R as me}from"./team-a9599a92.js";import{b as P,M as le}from"./paths-1d44e380.js";import{u as O}from"./useTranslation-f1e31b7f.js";import{S as ce}from"./SettingOutlined-58db4ea1.js";import"./button-255d95e9.js";import"./Sider-2eea88ce.js";import"./dayjs.min-e1e47a26.js";import"./tslib.es6-5f87f175.js";import"./alertTypes-bd9943c7.js";import"./index-74275833.js";import"./index-c0d2be16.js";import"./index-217cb9e2.js";import"./index-4e5c896b.js";import"./index-d4c68e4d.js";import"./AuthTokensStore-9401662d.js";import"./index-801816c4.js";import"./validations-55614028.js";import"./genName-6cc4e155.js";import"./index-03282bf3.js";import"./index-19cf5167.js";import"./capitalize-b2c18dd5.js";import"./index-74b97788.js";import"./trash-colored-debd1411.js";import"./index-b094a404.js";import"./index-b0c28476.js";import"./dataSources-efcbf825.js";import"./urql.es-e4ed66a8.js";const de="_wrapper_st3j9_1",pe="_body_st3j9_5",fe="_deleteItem_st3j9_9",ue="_deleteText_st3j9_12",h={wrapper:de,body:pe,deleteItem:fe,deleteText:ue},xe=({dataSources:g=[],disableCreate:i=!1,loading:b=!1,defaultOpen:S=!1,onDataSourceSelect:a=()=>{},onTestConnection:n=()=>{},onDataSourceSetupSubmit:c=()=>{},onDataModelGenerationSubmit:p=()=>{},onEdit:j=()=>{},onDelete:m=()=>{},onFinish:r=()=>{},onGenerate:D=()=>{}})=>{const{t:o}=O(["settings","pages"]),[,l]=N(),{setStep:w,clean:_,setIsOnboarding:f}=I(),F=Q(),C=()=>{f(!0),l(`${P}/new`)},u=d.useCallback(()=>{l(P)},[l]),x=()=>{u(),r()},k=t=>{D(t),w(2)},y=t=>e.jsx(Z,{title:t.name,titleTooltip:t.name,onTitleClick:()=>!i&&t.id&&j(t.id),extra:!i&&e.jsx(B,{className:h.btn,trigger:["click"],menu:{items:[{key:"edit",label:o("common:words.edit"),onClick:()=>t.id&&j(t.id)},{key:"generate",label:o("common:words.generate_models"),onClick:()=>t.id&&k(t.id)},{key:"delete",className:h.deleteItem,label:e.jsx(te,{title:o("common:words.delete_datasource"),className:h.deleteText,onConfirm:()=>t.id&&m(t.id),children:o("common:words.delete")})}]},children:e.jsx(ce,{},"setting")}),children:e.jsxs("dl",{children:[t.dbParams.host&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:o("common:words.host")}),e.jsx("dd",{title:t.dbParams.host,children:t.dbParams.host})]}),t.type&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:o("common:words.type")}),e.jsx("dd",{children:e.jsx(ne,{dataSource:t.type})})]}),t.createdAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:o("common:words.created_at")}),e.jsx("dd",{title:M(t.createdAt),children:M(t.createdAt)})]}),t.updatedAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:o("common:words.updated_at")}),e.jsx("dd",{title:M(t.updatedAt),children:M(t.updatedAt)})]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(K,{spinning:b,children:[g.length===0&&e.jsx(se,{onConnect:i?void 0:C}),g.length>0&&e.jsxs(J,{className:h.wrapper,direction:"vertical",size:13,children:[e.jsx(oe,{title:F.sm?o("settings:data_sources.title"):o("settings:data_sources.title_mobile"),action:!i&&o("settings:data_sources.create_now"),actionProps:{type:"primary",size:"large"},onClick:C}),e.jsx("div",{className:h.body,children:e.jsx(W,{justify:"start",gutter:[32,32],children:g.map(t=>e.jsx(q,{xs:24,sm:12,xl:8,children:y(t)},t.id))})})]})]}),e.jsx(ee,{open:S,onClose:u,closable:!0,afterClose:_,width:1e3,classNames:{modal:h.modal},modalStyles:{padding:0},children:e.jsx(X,{onFinish:x,onDataSourceSelect:a,onTestConnection:n,onDataSourceSetupSubmit:c,onDataModelGenerationSubmit:p,loading:b,bordered:!1,shadow:!1})})]})},rt=()=>{const{t:g}=O(["dataSourceStepForm"]),{currentTeam:i,loading:b,setLoading:S}=re(),[,a]=N(),{editId:n,generate:c}=V(),p=P,j=le,m=n==="new",{formState:{step1:r},isGenerate:D,setIsGenerate:o,setStep:l,setIsOnboarding:w,clean:_,nextStep:f,setFormStateData:F}=I(),{loading:C,dataSources:u,curDataSource:x,onDataModelGenerationSubmit:k,onDataSourceSetupSubmit:y}=Y({editId:n}),[t,R]=ie();ae(t,()=>{},{successMessage:g("datasource_deleted")});const E=d.useCallback(()=>{let s=j;r!=null&&r.id&&(s=`${s}/${r.id}`),_(),a(s)},[r==null?void 0:r.id,j,_,a]),G=s=>{S(!0),R({id:s})},$=s=>{a(`${p}/${s}`)};d.useEffect(()=>{!m&&u.length&&n&&!x&&a(p)},[p,x,n,u.length,a,m]);const A=s=>{F(0,s),f()},L=async s=>{await y(s,!1,f)},v=async s=>{const T=await k(s);if(n&&T){E();return}T&&f()},z=async s=>{await y(s,!0,f)};d.useEffect(()=>{m&&w(!0)},[m,w]),d.useEffect(()=>{!m&&n&&!c&&l(1)},[m,n,c,l]),d.useEffect(()=>{c&&c==="generate"&&o(!0)},[c,o]),d.useEffect(()=>{D&&x&&l(2)},[D,x,l]);const U=s=>{a(`${p}/${s}/generate`)},H=(i==null?void 0:i.role)===me.member;return e.jsx(xe,{defaultOpen:!!n,disableCreate:H,dataSources:u,loading:b||C,onEdit:$,onDelete:G,onFinish:E,onGenerate:U,onTestConnection:z,onDataSourceSelect:A,onDataSourceSetupSubmit:L,onDataModelGenerationSubmit:v})};export{xe as DataSources,rt as default};
